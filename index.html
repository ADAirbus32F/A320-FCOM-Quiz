
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FCOM A320 Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f8fb;
      margin: 0;
      padding: 0;
      color: #002244;
    }
    header {
      background: #005BAC;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.2rem;
      font-weight: bold;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 20px;
    }
    label {
      display: block;
      margin: 12px 0;
      font-size: 1rem;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: rgba(255,255,255,0.1);
      color: white;
    }
    label.selected {
      background-color: #005BAC;
      color: white;
    }
    input[type="radio"] {
      transform: scale(1.3);
      margin-right: 10px;
    }
    button {
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      background: #00487A;
      color: white;
      border: none;
      font-size: 1rem;
      border-radius: 6px;
      cursor: pointer;
    }
    .feedback {
      font-weight: bold;
      margin-top: 15px;
    }
    .correct { color: #00ffae; }
    .incorrect { color: #ff7373; }
    .progress-container {
      display: flex;
      justify-content: space-between;
      margin: 15px 0;
    }
    .bubble {
      width: 20px;
      height: 20px;
      background: #cce0f4;
      border-radius: 50%;
    }
    .bubble.active {
      background: #005BAC;
    }
    footer {
      font-size: 0.8rem;
      text-align: center;
      color: #666;
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <header>FCOM A320 – Quiz por Capítulo</header>
  <div class="container" id="menu">
    <h2>1. Escolha o capítulo</h2>
    <select id="chapterSelect">
      <option value="">-- Selecione o capítulo --</option>
    </select>
    <h2>2. Escolha o modo</h2>
    <select id="modeSelect" disabled>
      <option value="">-- Escolha o modo --</option>
      <option value="study">Study Mode (feedback por questão)</option>
      <option value="exam">Evaluation Mode (feedback no final)</option>
    </select>
    <p id="modeDescription" style="font-size: 0.9rem; min-height: 40px;"></p>
    <button id="startBtn" onclick="startQuiz()" disabled>Iniciar Quiz</button>
  </div>

  <div class="container" id="quiz" style="display:none;">
    <div class="progress-container" id="progressBubbles"></div>
    <div id="quizContainer"></div>
    <div class="navigation">
      <button onclick="prevQuestion()">Voltar</button>
      <button onclick="nextQuestion()">Próximo</button>
      <button onclick="submitQuiz()">Finalizar</button>
    </div>
    <div id="results" class="feedback"></div>
  </div>

  <footer>Fonte: FCOM Airbus A320 | Azul Linhas Aéreas Brasileiras</footer>

  <script>
    let allQuestions = [];
    let questions = [];
    let current = 0;
    let answers = [];
    let mode = "study";

    fetch('index.csv')
      .then(response => response.text())
      .then(csv => {
        const lines = csv.trim().split("\n");
        const headers = lines[0].split(",");
        allQuestions = lines.slice(1).map(line => {
          const parts = line.split(",");
          return {
            question: parts[0],
            options: [parts[1], parts[2], parts[3], parts[4]],
            correct: parts[parseInt(parts[5])],
            chapter: parts[6]
          };
        });
        populateChapters();
      });

    function populateChapters() {
      const chapters = [...new Set(allQuestions.map(q => q.chapter))];
      const chapterSelect = document.getElementById("chapterSelect");
      chapters.forEach(ch => {
        const opt = document.createElement("option");
        opt.value = ch;
        opt.textContent = ch;
        chapterSelect.appendChild(opt);
      });
    }

    document.getElementById("chapterSelect").addEventListener("change", () => {
      document.getElementById("modeSelect").disabled = false;
    });

    document.getElementById("modeSelect").addEventListener("change", () => {
      const selected = document.getElementById("modeSelect").value;
      mode = selected;
      if (selected === "study") {
        document.getElementById("modeDescription").textContent = "Você receberá feedback imediato após cada questão.";
      } else if (selected === "exam") {
        document.getElementById("modeDescription").textContent = "Você responderá todas as questões primeiro. Feedback ao final.";
      }
      document.getElementById("startBtn").disabled = false;
    });

    function startQuiz() {
      const chapter = document.getElementById("chapterSelect").value;
      questions = allQuestions.filter(q => q.chapter === chapter);
      answers = Array(questions.length).fill(null);
      current = 0;
      document.getElementById("menu").style.display = "none";
      document.getElementById("quiz").style.display = "block";
      loadQuestion(current);
    }

    function renderBubbles() {
      const container = document.getElementById("progressBubbles");
      container.innerHTML = "";
      for (let i = 0; i < questions.length; i++) {
        const div = document.createElement("div");
        div.className = "bubble" + (i === current ? " active" : "");
        container.appendChild(div);
      }
    }

    function loadQuestion(index) {
      const q = questions[index];
      let html = `<div class='question-block'><h2>Questão ${index+1} de ${questions.length}</h2><p>${q.question}</p>`;
      q.options.forEach(opt => {
        const isSelected = answers[index] === opt ? "selected" : "";
        html += `<label class='${isSelected}'><input type='radio' name='q${index}' value='${opt}' onclick='checkAnswer(${index}, "${opt}")'> ${opt}</label>`;
      });
      html += `<div id='feedback${index}' class='feedback'></div></div>`;
      document.getElementById("quizContainer").innerHTML = html;
      renderBubbles();
    }

    function checkAnswer(index, selected) {
      answers[index] = selected;
      loadQuestion(index);
      if (mode === "study") {
        const feedbackDiv = document.getElementById("feedback" + index);
        const correct = questions[index].correct;
        feedbackDiv.innerHTML = "";
        if (selected === correct) {
          feedbackDiv.innerHTML = "<span class='correct'>Correto!</span>";
        } else {
          feedbackDiv.innerHTML = "<span class='incorrect'>Incorreto.</span>";
        }
      }
    }

    function prevQuestion() {
      if (current > 0) {
        current--;
        loadQuestion(current);
      }
    }

    function nextQuestion() {
      if (current < questions.length - 1) {
        current++;
        loadQuestion(current);
      }
    }

    function submitQuiz() {
      let score = 0;
      for (let i = 0; i < questions.length; i++) {
        if (answers[i] === questions[i].correct) score++;
      }
      let resultText = "Você acertou " + score + " de " + questions.length + " questões.";
      if (mode === "exam") {
        resultText += "<br><br>Revisão:<br>";
        for (let i = 0; i < questions.length; i++) {
          resultText += "Q" + (i+1) + ": " + questions[i].question + "<br>";
          resultText += "Sua resposta: " + (answers[i] || "Sem resposta") + "<br>";
          resultText += "Correta: " + questions[i].correct + "<br><br>";
        }
      }
      document.getElementById("results").innerHTML = resultText;
    }
  </script>
</body>
</html>
